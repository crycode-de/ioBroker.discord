{
  "version": 3,
  "sources": ["../src/commands.ts"],
  "sourcesContent": ["import { isDeepStrictEqual } from 'node:util';\n\nimport { boundMethod } from 'autobind-decorator';\n\nimport {\n  ApplicationCommandOptionType,\n  AutocompleteInteraction,\n  CacheType,\n  ChannelType,\n  Collection,\n  CommandInteraction,\n  DiscordAPIError,\n  Guild,\n  GuildChannel,\n  GuildMember,\n  Interaction,\n  MessageCreateOptions,\n  Role,\n  Snowflake,\n  User,\n} from 'discord.js';\nimport { SlashCommandBuilder } from '@discordjs/builders';\nimport { REST } from '@discordjs/rest';\nimport { Routes } from 'discord-api-types/v10';\n\nimport type { DiscordAdapter } from './main';\nimport { i18n } from './lib/i18n';\nimport {\n  getBasenameFromFilePathOrUrl,\n  getBufferAndNameFromBase64String,\n  userNameOrTag,\n} from './lib/utils';\nimport { ChannelTypeNames, JsonSlashCommandObj } from './lib/definitions';\n\nexport interface CommandObjectConfig {\n  id: string;\n  alias: string;\n  name: string;\n  get: boolean;\n  set: boolean;\n}\n\ninterface CommandOptionChoiceData {\n  name: string;\n  value: string;\n}\n\n/**\n * Class for discord slash commands handling\n */\nexport class DiscordAdapterSlashCommands {\n\n  /**\n   * Reference to the adapter instance.\n   */\n  private adapter: DiscordAdapter;\n\n  /**\n   * Discord REST api interface.\n   */\n  private rest: REST = new REST({ version: '10' });\n\n  /**\n   * Command name for the get state command.\n   */\n  private cmdGetStateName: string = 'iob-get';\n\n  /**\n   * Command name for the set state command.\n   */\n  private cmdSetStateName: string = 'iob-set';\n\n  /**\n   * Possible choices for get state command state-option.\n   */\n  private cmdGetStateChoices: CommandOptionChoiceData[] = [];\n\n  /**\n   * Possible choices for set state command state-option.\n   */\n  private cmdSetStateChoices: CommandOptionChoiceData[] = [];\n\n  /**\n   * Collection of the known (registered) custom commands and their option choices.\n   */\n  private customCommands: Collection<string, Collection<string, CommandOptionChoiceData[]>> = new Collection();\n\n  /**\n   * If commands are fully registered including their permissions.\n   */\n  private registerCommandsDone: boolean = false;\n\n  /**\n   * The last registered commands.\n   * Used to check if something changed an we need to register the commands again.\n   */\n  private lastCommandsJson: any[] | null = null;\n\n  /**\n   * Collection of configurations for objects with commands enabled.\n   */\n  private commandObjectConfig: Collection<string, CommandObjectConfig> = new Collection();\n\n  /**\n   * Collection of the last seen interactions of custom commands (not iob-get/-set).\n   * Need to cache this here since there seams be no way to get an interaction by ID from discord.js.\n   */\n  private lastInteractions: Collection<Snowflake, CommandInteraction<CacheType>> = new Collection();\n\n  /**\n   * Timeout to trigger the delayed registration of the slash commands.\n   */\n  private triggerDelayedRegisterSlashCommandsTimeout: ioBroker.Timeout | null = null;\n\n  /**\n   * Set of well known values that will be interperted as true.\n   * This is extended by some localized strings at runtime.\n   * Used to determine true values from iob-set slash commands.\n   */\n  private wellKnownbooleanTrueValues: Set<string> = new Set(['true', 'on', 'yes', '1']);\n\n  constructor (adapter: DiscordAdapter) {\n    this.adapter = adapter;\n  }\n\n  /**\n   * When the adapter is Ready.\n   * Called by `adapter.onReady()` after some basic checks and setup.\n   */\n  public async onReady (): Promise<void> {\n    // apply custom command names if configured\n    if (this.adapter.config.cmdGetStateName) {\n      if (this.adapter.config.cmdGetStateName.match(/^[a-z][0-9a-z-_]{1,32}$/)) {\n        this.cmdGetStateName = this.adapter.config.cmdGetStateName;\n      } else {\n        this.adapter.log.warn(`Invalid custom get state command name '${this.adapter.config.cmdGetStateName}' provied! Using default 'iob-get'.`);\n      }\n    }\n    if (this.adapter.config.cmdSetStateName) {\n      this.cmdSetStateName = this.adapter.config.cmdSetStateName;\n      if (this.adapter.config.cmdSetStateName.match(/^[a-z][0-9a-z-_]{1,32}$/)) {\n        this.cmdSetStateName = this.adapter.config.cmdSetStateName;\n      } else {\n        this.adapter.log.warn(`Invalid custom set state command name '${this.adapter.config.cmdSetStateName}' provied! Using default 'iob-set'.`);\n      }\n    }\n\n    // setup REST interface\n    this.rest.setToken(this.adapter.config.token);\n\n    // check if commands are enabled\n    if (!this.adapter.config.enableCommands) {\n      return;\n    }\n\n    // add translated versions of true/on/yes to the set of well known boolean true values\n    this.wellKnownbooleanTrueValues.add(i18n.getString('true'))\n      .add(i18n.getString('on'))\n      .add(i18n.getString('yes'));\n\n    // setup interaction handler for commands\n    if (!this.adapter.client) {\n      throw new Error('Tried to setup interaction handler for commands, but client is not initialized!');\n    }\n    this.adapter.client.on('interactionCreate', this.onInteractionCreate);\n  }\n\n  /**\n   * Register the commands on discord, if enabled.\n   */\n  public async registerSlashCommands (): Promise<void> {\n    this.registerCommandsDone = false;\n\n    if (!this.adapter.client?.user) {\n      throw new Error('Discord client not available');\n    }\n\n    if (this.adapter.unloaded) return;\n\n    // check if commands are enabled and if not remove set commands\n    if (!this.adapter.config.enableCommands) {\n      this.adapter.log.debug('Commands not enabled');\n\n      // check for commands and remove them all\n      for (const [, guild] of this.adapter.client.guilds.cache) {\n        await this.removeGuildCommands(guild);\n      }\n\n      await this.removeGlobalCommands();\n\n      return;\n    }\n\n    // build commands array\n    const commands: SlashCommandBuilder[] = [];\n\n    const numGet = this.commandObjectConfig.filter((c) => c.get === true).size;\n    const numSet = this.commandObjectConfig.filter((c) => c.set === true).size;\n\n    // setup iob-get command if objects configured for get\n    if (numGet > 0) {\n      const cmdGet = new SlashCommandBuilder()\n        .setName(this.cmdGetStateName)\n        .setDescription(i18n.getString('Get an ioBroker state value'));\n\n      // add options\n      cmdGet.addStringOption((opt) => (\n        opt.setName('state')\n          .setDescription(i18n.getString('The ioBroker state to get'))\n          .setRequired(true)\n          .setAutocomplete(true)\n      ));\n\n      commands.push(cmdGet);\n    }\n\n    // setup iob-set command if objects configured for set\n    if (numSet > 0) {\n      const cmdSet = new SlashCommandBuilder()\n        .setName(this.cmdSetStateName)\n        .setDescription(i18n.getString('Set an ioBroker state value'));\n\n      cmdSet.addStringOption((opt) => (\n        opt.setName('state')\n          .setDescription(i18n.getString('The ioBroker state to set'))\n          .setRequired(true)\n          .setAutocomplete(true)\n      ));\n      cmdSet.addStringOption((opt) => {\n        return opt.setName('value')\n          .setDescription(i18n.getString('The value to set'))\n          .setRequired(true);\n      });\n\n      commands.push(cmdSet);\n    }\n\n    // setup choices for get and set commands\n    this.cmdGetStateChoices = [];\n    this.cmdSetStateChoices = [];\n    for (const [, objCfg] of this.commandObjectConfig) {\n      if (objCfg.get) {\n        this.cmdGetStateChoices.push({\n          name: objCfg.name,\n          value: objCfg.alias,\n        });\n      }\n      if (objCfg.set) {\n        this.cmdSetStateChoices.push({\n          name: objCfg.name,\n          value: objCfg.alias,\n        });\n      }\n    }\n\n    // sort choices for get and set commands\n    const sortFn = (a: CommandOptionChoiceData, b: CommandOptionChoiceData): -1 | 0 | 1 => {\n      if (a.name > b.name) return 1;\n      if (a.name < b.name) return -1;\n      return 0;\n    };\n    this.cmdGetStateChoices.sort(sortFn);\n    this.cmdSetStateChoices.sort(sortFn);\n\n    // custom commands\n    this.customCommands.clear();\n    if (this.adapter.config.enableCustomCommands) {\n      loopCustomCommands:\n      for (const customCommandCfg of this.adapter.config.customCommands) {\n        if (!customCommandCfg.name.match(/^[a-z][0-9a-z-_]{1,32}$/) || customCommandCfg.description.length === 0 || customCommandCfg.description.length > 100) {\n          this.adapter.log.warn(`Custom command \"${customCommandCfg.name}\" has an invalid name or description configured!`);\n          continue;\n        }\n\n        if (customCommandCfg.name === this.cmdGetStateName) {\n          this.adapter.log.warn(`Custom command \"${customCommandCfg.name}\" is configured but conflicts with default get command! The command will be ignored.`);\n          continue;\n        }\n        if (customCommandCfg.name === this.cmdSetStateName) {\n          this.adapter.log.warn(`Custom command \"${customCommandCfg.name}\" is configured but conflicts with default set command! The command will be ignored.`);\n          continue;\n        }\n\n        if (this.customCommands.has(customCommandCfg.name)) {\n          this.adapter.log.warn(`Custom command \"${customCommandCfg.name}\" is configured multiple times! The command will be ignored.`);\n          continue;\n        }\n\n        // create the command\n        const cmdCustom = new SlashCommandBuilder()\n          .setName(customCommandCfg.name)\n          .setDescription(customCommandCfg.description);\n\n        const optionsChoices = new Collection<string, CommandOptionChoiceData[]>();\n\n        // add configured options\n        const cmdOpts: Set<string> = new Set();\n        if (Array.isArray(customCommandCfg.options)) {\n          // max 25 options are allowed\n          if (customCommandCfg.options.length > 25) {\n            this.adapter.log.warn(`Custom command \"${customCommandCfg.name}\" has more than 25 options configured! Only the first 25 options will be used.`);\n            customCommandCfg.options.splice(25);\n          }\n        } else {\n          customCommandCfg.options = [];\n        }\n\n        // create/update the ioBroker objects\n        await this.setupCustomCommandIobObjects(customCommandCfg);\n\n        for (const customCommandCfgOpt of customCommandCfg.options) {\n          if (!customCommandCfgOpt.name.match(/^[a-z][0-9a-z-_]{1,32}$/) || customCommandCfgOpt.description.length === 0 || customCommandCfgOpt.description.length > 100) {\n            this.adapter.log.warn(`Custom command \"${customCommandCfg.name}\" option \"${customCommandCfgOpt.name}\" has an invalid name or description configured!`);\n            continue loopCustomCommands;\n          }\n\n          if (cmdOpts.has(customCommandCfgOpt.name)) {\n            this.adapter.log.warn(`Custom command \"${customCommandCfg.name}\" option \"${customCommandCfgOpt.name}\" is configured multiple times! The command will be ignored.`);\n            continue loopCustomCommands;\n          }\n          cmdOpts.add(customCommandCfgOpt.name);\n\n          switch (customCommandCfgOpt.type) {\n            case 'string':\n              // string options may have choices from the ioBroker object\n              let choices: (string | CommandOptionChoiceData)[] = [];\n              try {\n                const val = (await this.adapter.getStateAsync(`slashCommands.${customCommandCfg.name}.option-${customCommandCfgOpt.name}.choices`))?.val ?? '[]';\n                if (typeof val !== 'string') {\n                  this.adapter.log.warn(`Value of ${this.adapter.namespace}.slashCommands.${customCommandCfg.name}.option-${customCommandCfgOpt.name}.choices is not a string!`);\n                } else {\n                  choices = JSON.parse(val);\n                }\n              } catch (err) {\n                this.adapter.log.warn(`Could not parse JSON from ${this.adapter.namespace}.slashCommands.${customCommandCfg.name}.option-${customCommandCfgOpt.name}.choices! ${err}`);\n              }\n\n              optionsChoices.set(customCommandCfgOpt.name, choices.map((choice) => {\n                if (typeof choice === 'string' && choice.length >= 1 && choice.length <= 100) {\n                  return { name: choice, value: choice };\n                } else if (typeof choice === 'object' && typeof choice.value === 'string' && typeof choice.name === 'string' && choice.name.length >= 1 && choice.name.length <= 100 && choice.value.length <= 100) {\n                  return { name: choice.name, value: choice.value };\n                } else {\n                  this.adapter.log.warn(`Choice ${JSON.stringify(choice)} is not valid for ${this.adapter.namespace}.slashCommands.${customCommandCfg.name}.option-${customCommandCfgOpt.name}.choices and will be ignored!`);\n                  return null;\n                }\n              }).filter((choice) => choice !== null) as CommandOptionChoiceData[]);\n\n              cmdCustom.addStringOption((opt) => {\n                opt.setName(customCommandCfgOpt.name)\n                  .setDescription(customCommandCfgOpt.description)\n                  .setRequired(!!customCommandCfgOpt.required);\n\n                if (choices.length > 0) {\n                  opt.setAutocomplete(true);\n                }\n\n                return opt;\n              });\n              break;\n\n            case 'number':\n              cmdCustom.addNumberOption((opt) => opt.setName(customCommandCfgOpt.name).setDescription(customCommandCfgOpt.description).setRequired(!!customCommandCfgOpt.required));\n              break;\n\n            case 'boolean':\n              cmdCustom.addBooleanOption((opt) => opt.setName(customCommandCfgOpt.name).setDescription(customCommandCfgOpt.description).setRequired(!!customCommandCfgOpt.required));\n              break;\n\n            case 'user':\n              cmdCustom.addUserOption((opt) => opt.setName(customCommandCfgOpt.name).setDescription(customCommandCfgOpt.description).setRequired(!!customCommandCfgOpt.required));\n              break;\n\n            case 'role':\n              cmdCustom.addRoleOption((opt) => opt.setName(customCommandCfgOpt.name).setDescription(customCommandCfgOpt.description).setRequired(!!customCommandCfgOpt.required));\n              break;\n\n            case 'channel':\n              cmdCustom.addChannelOption((opt) => opt.setName(customCommandCfgOpt.name).setDescription(customCommandCfgOpt.description).setRequired(!!customCommandCfgOpt.required));\n              break;\n\n            case 'mentionable':\n              cmdCustom.addMentionableOption((opt) => opt.setName(customCommandCfgOpt.name).setDescription(customCommandCfgOpt.description).setRequired(!!customCommandCfgOpt.required));\n              break;\n\n            default:\n              this.adapter.log.warn(`Custom command \"${customCommandCfg.name}\" option \"${customCommandCfgOpt.name} has an invalid type set\"!`);\n              continue loopCustomCommands;\n          }\n        }\n\n        // add custom command to the commands\n        commands.push(cmdCustom);\n        this.customCommands.set(customCommandCfg.name, optionsChoices);\n      }\n\n      /*\n       * find and delete old custom slash command objects\n       */\n      const objListSlashCommands = await this.adapter.getObjectListAsync({\n        startkey: `${this.adapter.namespace}.slashCommands.`,\n        endkey: `${this.adapter.namespace}.slashCommands.\\u9999`,\n      });\n      const re = new RegExp(`^${this.adapter.name}\\\\.${this.adapter.instance}\\\\.slashCommands\\\\.([^.]+)$`);\n      for (const item of objListSlashCommands.rows) {\n        const m = item.id.match(re);\n        if (m) {\n          const cmdName = m[1];\n          if (!this.customCommands.has(cmdName)) {\n            this.adapter.log.debug(`Custom slash command ${cmdName} is not configured - deleting objects`);\n            await this.adapter.delObjectAsyncCached(`slashCommands.${cmdName}`, { recursive: true });\n          }\n        }\n      }\n    }\n\n    // check if any command is set and log an warning if not\n    if (commands.length === 0) {\n      if (this.adapter.config.enableCustomCommands) {\n        this.adapter.log.warn('Commands are enabled but not configured for any state object and no custom commands are configured! Use the custom configuration of a state object to activate commands on it or add custom commands in the adapter instance configuration.');\n      } else {\n        this.adapter.log.warn('Commands are enabled but not configured for any state object! Use the custom configuration of a state object to activate commands on it.');\n      }\n    }\n\n    const commandsJson = commands.map((cmd) => cmd.toJSON());\n\n    // only update the commands if something has changed\n    if (!isDeepStrictEqual(commandsJson, this.lastCommandsJson)) {\n      this.adapter.log.debug('Commands needs to be updated');\n\n      // register commands for all servers of the bot (guild commands are applied instant and may have permissions per user set)\n      for (const [, guild] of this.adapter.client.guilds.cache) {\n        try {\n          if (this.adapter.config.commandsGlobal) {\n            // global commands enabled, remove per guild commands\n            await this.removeGuildCommands(guild);\n\n          } else {\n            // commands per guild\n            await this.rest.put(Routes.applicationGuildCommands(this.adapter.client.user.id, guild.id), { body: commandsJson });\n            this.adapter.log.info(`Registered commands for server ${guild.name} (id:${guild.id}) (get: ${numGet}, set: ${numSet}, custom: ${this.customCommands.size})`);\n          }\n\n        } catch (err) {\n          if (err instanceof DiscordAPIError && err.message === 'Missing Access'){\n            this.adapter.log.warn(`Error registering commands for server ${guild.name} (id:${guild.id}). Seams like the bot is missing the 'applications.commands' scope on the server. ${err}`);\n          } else {\n            this.adapter.log.warn(`Error registering commands for server ${guild.name} (id:${guild.id}): ${err}`);\n          }\n        }\n      }\n\n      // register global commands if enabled\n      try {\n        if (this.adapter.config.commandsGlobal) {\n          // global commands enabled\n          await this.rest.put(Routes.applicationCommands(this.adapter.client.user.id), { body: commandsJson });\n          this.adapter.log.info(`Registered global commands (get: ${numGet}, set: ${numSet}, custom: ${this.customCommands.size})`);\n\n        } else {\n          // global command disabled\n          await this.removeGlobalCommands();\n        }\n\n      } catch (err) {\n        if (err instanceof DiscordAPIError && err.message === 'Missing Access') {\n          this.adapter.log.warn(`Error registering global commands. Seams like the bot is missing the 'applications.commands' scope on the server. ${err}`);\n        } else {\n          this.adapter.log.warn(`Error registering global commands: ${err}`);\n        }\n      }\n\n      // cache the commandsJson for the next call of `registerSlashCommands()`\n      this.lastCommandsJson = commandsJson;\n\n    } else {\n      this.adapter.log.debug('Commands seams to be up to date');\n    }\n\n    this.registerCommandsDone = true;\n  }\n\n\n  /**\n   * Remove registered global commands if any.\n   */\n  private async removeGlobalCommands (): Promise<void> {\n    if (!this.adapter.client?.user) {\n      throw new Error('Discord client not available');\n    }\n\n    try {\n      const globalCommands = await this.adapter.client.application?.commands.fetch();\n      if (this.adapter.unloaded) return;\n\n      if (globalCommands && globalCommands.size > 0) {\n        this.adapter.log.debug(`Currently ${globalCommands.size} global commands registered. Removing them...`);\n        await this.rest.put(Routes.applicationCommands(this.adapter.client.user.id), { body: [] });\n        this.adapter.log.info(`Removed global commands cause commands they are not used anymore.`);\n      }\n    } catch (err) {\n      if (err instanceof DiscordAPIError && err.message === 'Missing Access') {\n        this.adapter.log.warn(`Error while removing registered global commands. Seams like the bot is missing the 'applications.commands' scope on the server. ${err}`);\n      } else {\n        this.adapter.log.warn(`Error while removing registered global commands: ${err}`);\n      }\n    }\n  }\n\n  /**\n   * Remove registered guild commands if any.\n   * @param guild The guild.\n   */\n  private async removeGuildCommands (guild: Guild): Promise<void> {\n    if (!this.adapter.client?.user) {\n      throw new Error('Discord client not available');\n    }\n\n    try {\n      const guildCommands = await guild.commands.fetch();\n      if (this.adapter.unloaded) return;\n\n      if (guildCommands.size > 0) {\n        this.adapter.log.debug(`Currently ${guildCommands.size} commands registered for server ${guild.name}. Removing them...`);\n        await this.rest.put(Routes.applicationGuildCommands(this.adapter.client.user.id, guild.id), { body: [] });\n        this.adapter.log.info(`Removed commands for server ${guild.name} cause commands they are not used anymore.`);\n      }\n    } catch (err) {\n      if (err instanceof DiscordAPIError && err.message === 'Missing Access') {\n        this.adapter.log.warn(`Error while removing registered commands for server ${guild.name} (id:${guild.id}). Seams like the bot is missing the 'applications.commands' scope on the server. ${err}`);\n      } else {\n        this.adapter.log.warn(`Error while removing registered commands for server ${guild.name} (id:${guild.id}): ${err}`);\n      }\n    }\n  }\n\n  /**\n   * Setup the ioBroker object tree for the configured custom commands.\n   */\n  private async setupCustomCommandIobObjects (cmdCfg: ioBroker.AdapterConfigCustomCommand): Promise<void> {\n    const cmdName = cmdCfg.name;\n\n    await this.adapter.extendObjectAsyncCached(`slashCommands.${cmdName}`, {\n      type: 'channel',\n      common: {\n        name: cmdCfg.description,\n      },\n      native: {},\n    });\n\n    // generic custom command objects\n    await Promise.all([\n      this.adapter.extendObjectAsyncCached(`slashCommands.${cmdName}.json`, {\n        type: 'state',\n        common: {\n          name: i18n.getStringOrTranslated('JSON data'),\n          role: 'json',\n          type: 'string',\n          read: true,\n          write: false,\n          def: '',\n        },\n        native: {},\n      }),\n      this.adapter.extendObjectAsyncCached(`slashCommands.${cmdName}.timestamp`, {\n        type: 'state',\n        common: {\n          name: i18n.getStringOrTranslated('Last use timestamp'),\n          role: 'date',\n          type: 'number',\n          read: true,\n          write: false,\n          def: 0,\n        },\n        native: {},\n      }),\n      this.adapter.extendObjectAsyncCached(`slashCommands.${cmdName}.sendReply`, {\n        type: 'state',\n        common: {\n          name: i18n.getStringOrTranslated('Send reply'),\n          role: 'text',\n          type: 'string',\n          read: false,\n          write: true,\n          def: '',\n        },\n        native: {},\n      }),\n      this.adapter.extendObjectAsyncCached(`slashCommands.${cmdName}.interactionId`, {\n        type: 'state',\n        common: {\n          name: i18n.getStringOrTranslated('Interaction ID'),\n          role: 'text',\n          type: 'string',\n          read: true,\n          write: false,\n          def: '',\n        },\n        native: {},\n      }),\n      this.adapter.extendObjectAsyncCached(`slashCommands.${cmdName}.userId`, {\n        type: 'state',\n        common: {\n          name: i18n.getStringOrTranslated('User ID'),\n          role: 'text',\n          type: 'string',\n          read: true,\n          write: false,\n          def: '',\n        },\n        native: {},\n      }),\n      this.adapter.extendObjectAsyncCached(`slashCommands.${cmdName}.userTag`, {\n        type: 'state',\n        common: {\n          name: i18n.getStringOrTranslated('User tag'),\n          role: 'text',\n          type: 'string',\n          read: true,\n          write: false,\n          def: '',\n        },\n        native: {},\n      }),\n      this.adapter.extendObjectAsyncCached(`slashCommands.${cmdName}.userName`, {\n        type: 'state',\n        common: {\n          name: i18n.getStringOrTranslated('User name'),\n          role: 'text',\n          type: 'string',\n          read: true,\n          write: false,\n          def: '',\n        },\n        native: {},\n      }),\n      this.adapter.extendObjectAsyncCached(`slashCommands.${cmdName}.serverId`, {\n        type: 'state',\n        common: {\n          name: i18n.getStringOrTranslated('Server ID'),\n          role: 'text',\n          type: 'string',\n          read: true,\n          write: false,\n          def: '',\n        },\n        native: {},\n      }),\n      this.adapter.extendObjectAsyncCached(`slashCommands.${cmdName}.channelId`, {\n        type: 'state',\n        common: {\n          name: i18n.getStringOrTranslated('Channel ID'),\n          role: 'text',\n          type: 'string',\n          read: true,\n          write: false,\n          def: '',\n        },\n        native: {},\n      }),\n    ]);\n\n    // custom command option objects\n    const proms: Promise<any>[] = [];\n    for (const cmdCfgOpt of cmdCfg.options) {\n      await this.adapter.extendObjectAsyncCached(`slashCommands.${cmdName}.option-${cmdCfgOpt.name}`, {\n        type: 'channel',\n        common: {\n          name: i18n.getStringOrTranslated('Option %s', cmdCfgOpt.description),\n        },\n        native: {},\n      });\n\n      let role: string;\n      let type: ioBroker.CommonType;\n      let def: any;\n      switch (cmdCfgOpt.type) {\n        case 'number':\n          role = 'value';\n          type = 'number';\n          def = null;\n          break;\n\n        case 'boolean':\n          role = 'indicator';\n          type = 'boolean';\n          def = null;\n          break;\n\n        default:\n          role = 'text';\n          type = 'string';\n          def = '';\n      }\n\n      proms.push(this.adapter.extendObjectAsyncCached(`slashCommands.${cmdName}.option-${cmdCfgOpt.name}.value`, {\n        type: 'state',\n        common: {\n          name: i18n.getStringOrTranslated('Option %s value', cmdCfgOpt.description),\n          role,\n          type,\n          read: true,\n          write: false,\n          def,\n        },\n        native: {},\n      }));\n\n      // for string options add a choices state\n      if (cmdCfgOpt.type === 'string') {\n        proms.push(this.adapter.extendObjectAsyncCached(`slashCommands.${cmdName}.option-${cmdCfgOpt.name}.choices`, {\n          type: 'state',\n          common: {\n            name: i18n.getStringOrTranslated('Option %s choices', cmdCfgOpt.description),\n            role: 'json',\n            type: 'string',\n            read: true,\n            write: true,\n            def: '[]',\n          },\n          native: {},\n        }));\n      } else {\n        // remove the state for non-string options\n        proms.push(this.adapter.delObjectAsyncCached(`slashCommands.${cmdName}.option-${cmdCfgOpt.name}.choices`));\n      }\n    }\n\n    // check for unused (old) custom command option objects and remove them\n    const objListOptions = await this.adapter.getObjectListAsync({\n      startkey: `${this.adapter.namespace}.slashCommands.${cmdName}.option-`,\n      endkey: `${this.adapter.namespace}.slashCommands.${cmdName}.option-\\u9999`,\n    });\n    const reOptionsName = new RegExp(`^${this.adapter.name}\\\\.${this.adapter.instance}\\\\.slashCommands\\\\.${cmdName}\\\\.option-([^.]+)$`);\n    for (const item of objListOptions.rows) {\n      const m = item.id.match(reOptionsName);\n      if (m) {\n        const oldoptName = m[1];\n        if (!cmdCfg.options.find((o) => o.name === oldoptName)) {\n          // option does not exist... delete the object and custom command option choices cache\n          proms.push(this.adapter.delObjectAsyncCached(`slashCommands.${cmdName}.option-${oldoptName}`, { recursive: true }));\n          this.customCommands.get(cmdName)?.delete(oldoptName);\n        }\n      }\n    }\n\n    // wait for object create/delete\n    await Promise.all(proms);\n  }\n\n  /**\n   * Setup an ioBroker object for discord slash commands.\n   * @param objId ID of the ioBroker object to set up.\n   * @param cfg Command configuration for the ioBroker object or null to remove a possibly existing configuration.\n   */\n  public setupCommandObject (objId: string, cfg: CommandObjectConfig | null): void {\n    // check if alias is already in use\n    if (cfg) {\n      const conflictingAlias = this.commandObjectConfig.find((coc) => coc.alias === cfg?.alias && coc.id !== cfg.id);\n      if (conflictingAlias) {\n        this.adapter.log.warn(`Command alias ${cfg.alias} of object ${cfg.id} already in use by object ${conflictingAlias.id}! ${cfg.id} will be ignored.`);\n        cfg = null;\n      }\n    }\n\n    // remove if commands are not enabled or alias conflict\n    if (!cfg) {\n      if (this.commandObjectConfig.has(objId)) {\n        this.commandObjectConfig.delete(objId);\n        this.triggerDelayedRegisterSlashCommands();\n      }\n      return;\n    }\n\n    // update only if changed\n    const currentCfg = this.commandObjectConfig.get(objId);\n    if (!isDeepStrictEqual(cfg, currentCfg)) {\n      this.adapter.log.debug(`Update command configuration for ${objId}: ${JSON.stringify(cfg)}`);\n      this.commandObjectConfig.set(objId, cfg);\n      this.triggerDelayedRegisterSlashCommands();\n    }\n  }\n\n  /**\n   * Initialize a delayed registration of the slash commands.\n   * Calls `registerSlashCommands()` five seconds after the last call of this method.\n   * If called again within the five seconds the timeout starts again.\n   *\n   * This is used to handle object changes better and concat multiple changed\n   * object configurations into a single API call.\n   *\n   * If the initial custom objects setup of the adapter isn't done, this method\n   * does nothing since the command registration is called during this explicit.\n   */\n  public triggerDelayedRegisterSlashCommands (): void {\n    // do nothing on init\n    if (!this.adapter.initialCustomObjectSetupDone) return;\n\n    if (this.triggerDelayedRegisterSlashCommandsTimeout) {\n      this.adapter.clearTimeout(this.triggerDelayedRegisterSlashCommandsTimeout);\n    }\n\n    this.adapter.setTimeout(() => {\n      this.triggerDelayedRegisterSlashCommandsTimeout = null;\n      this.adapter.log.debug('Starting delayed slash commands registration...');\n      this.registerSlashCommands();\n    }, 5000);\n  }\n\n  /**\n   * Handle interactions.\n   */\n  @boundMethod\n  private async onInteractionCreate (interaction: Interaction<CacheType>): Promise<void> {\n\n    // raw states enabled?\n    if (this.adapter.config.enableRawStates) {\n      // set raw state... not async here since it should not block!\n      const interactionJson = interaction.toJSON() as Record<string, unknown>;\n      if (interaction.isCommand()) {\n        interactionJson.options = interaction.options.data;\n      }\n      this.adapter.setState('raw.interactionJson', JSON.stringify(interactionJson, (_key, value) => typeof value === 'bigint' ? value.toString() : value), true);\n    }\n\n    if (interaction.isCommand()) {\n      this.handleCommandInteraction(interaction);\n    } else if (interaction.isAutocomplete()) {\n      this.handleAutocompleteInteraction(interaction);\n    }\n  }\n\n  /**\n   * Handle command interactions.\n   */\n  private async handleCommandInteraction (interaction: CommandInteraction<CacheType>): Promise<void> {\n    const { commandName, user } = interaction;\n\n    if (!this.registerCommandsDone) {\n      this.adapter.log.warn(`Got command ${commandName} but command registration is not done yet.`);\n      return;\n    }\n\n    this.adapter.log.debug(`Got command ${commandName} ${JSON.stringify(interaction.options.data)}`);\n\n    const authCheckTarget = interaction.member instanceof GuildMember ? interaction.member : user;\n\n    if (commandName === this.cmdGetStateName) {\n      // check user authorization\n      if (this.adapter.checkUserAuthorization(authCheckTarget, { getStates: true })) {\n        // user authorized\n        await this.handleCmdGetState(interaction);\n      } else {\n        // user not authorized\n        this.adapter.log.warn(`User ${userNameOrTag(user)} (id:${user.id}) is not authorized to call /${commandName} commands!`);\n        await interaction.reply({\n          content: i18n.getString('You are not authorized to call this command!'),\n          ephemeral: true,\n        });\n      }\n\n    } else if (commandName === this.cmdSetStateName) {\n      // check user authorization\n      if (this.adapter.checkUserAuthorization(authCheckTarget, { setStates: true })) {\n        // user authorized\n        await this.handleCmdSetState(interaction);\n      } else {\n        // user not authorized\n        this.adapter.log.warn(`User ${userNameOrTag(user)} (id:${user.id}) is not authorized to call /${commandName} commands!`);\n        await interaction.reply({\n          content: i18n.getString('You are not authorized to call this command!'),\n          ephemeral: true,\n        });\n      }\n\n    } else if (this.customCommands.has(commandName)) {\n      // check user authorization\n      if (this.adapter.checkUserAuthorization(authCheckTarget, { useCustomCommands: true })) {\n        // user authorized\n        await this.handleCmdCustom(interaction);\n      } else {\n        // user not authorized\n        this.adapter.log.warn(`User ${userNameOrTag(user)} (id:${user.id}) is not authorized to call /${commandName} commands!`);\n        await interaction.reply({\n          content: i18n.getString('You are not authorized to call this command!'),\n          ephemeral: true,\n        });\n      }\n\n    } else {\n      this.adapter.log.warn(`Got unknown command ${commandName}!`);\n      await interaction.editReply(i18n.getString('Unknown command!'));\n    }\n  }\n\n  /**\n   * Handle autocomplete for command interactions.\n   */\n  private async handleAutocompleteInteraction (interaction: AutocompleteInteraction<CacheType>): Promise<void> {\n    const { commandName, user } = interaction;\n\n    const focused = interaction.options.getFocused(true);\n    let focusedValue: string;\n    if (typeof focused.value !== 'string') {\n      return interaction.respond([]);\n    } else {\n      focusedValue = focused.value.toLowerCase();\n    }\n\n    // check authorization\n    const authCheckTarget = interaction.member instanceof GuildMember ? interaction.member : user;\n\n    let choices: CommandOptionChoiceData[];\n\n    if (commandName === this.cmdGetStateName) {\n      // get state command\n      if (!this.adapter.checkUserAuthorization(authCheckTarget, { getStates: true })) {\n        return interaction.respond([]);\n      }\n\n      choices = this.cmdGetStateChoices;\n\n    } else if (commandName === this.cmdSetStateName) {\n      // set state command\n      if (!this.adapter.checkUserAuthorization(authCheckTarget, { setStates: true })) {\n        return interaction.respond([]);\n      }\n\n      choices = this.cmdSetStateChoices;\n\n    } else if (this.customCommands.has(commandName)) {\n      // custom command\n      if (!this.adapter.checkUserAuthorization(authCheckTarget, { useCustomCommands: true })) {\n        return interaction.respond([]);\n      }\n\n      choices = this.customCommands.get(commandName)?.get(focused.name) ?? [];\n\n    } else {\n      // unknown command\n      return interaction.respond([]);\n    }\n\n    // filter for given input\n    const matchedChoices = choices.filter((choice) => {\n      return choice.name.normalize('NFKC').toLowerCase().includes(focusedValue)\n        || choice.value.normalize('NFKC').toLowerCase().includes(focusedValue);\n    });\n\n    // max. 25 choices are allowed\n    matchedChoices.splice(25);\n\n    return interaction.respond(matchedChoices);\n  }\n\n  /**\n   * Try to get the ioBroker object and CommandObjectConfig for a given object alias.\n   * The object will be checked if it's a valid state object.\n   *\n   * In case of an error, a reply will be sent to the interaction.\n   * @param objAlias The alias of the object.\n   * @param interaction The interaction for replies on errors.\n   * @returns Array containing the object and the config or null and null.\n   */\n  private async getObjectAndCfgFromAlias (objAlias: string | null, interaction: CommandInteraction<CacheType>): Promise<[ioBroker.StateObject | null, CommandObjectConfig | null]> {\n    // find the config for the requested object\n    const cfg = this.commandObjectConfig.find((coc) => coc.alias === objAlias);\n    if (!cfg) {\n      if (interaction.replied) {\n        await interaction.editReply({\n          content: i18n.getString('Object `%s` not found!', objAlias ?? ''),\n        });\n      } else {\n        await interaction.reply({\n          content: i18n.getString('Object `%s` not found!', objAlias ?? ''),\n          ephemeral: true,\n        });\n      }\n      return [null, null];\n    }\n\n    // get the object\n    const obj = await this.adapter.getForeignObjectAsync(cfg.id);\n    if (!obj) {\n      if (interaction.replied) {\n        await interaction.editReply({\n          content: i18n.getString('Object `%s` not found!', cfg.id),\n        });\n      } else {\n        await interaction.reply({\n          content: i18n.getString('Object `%s` not found!', cfg.id),\n          ephemeral: true,\n        });\n      }\n      return [null, null];\n    }\n    if (obj.type !== 'state') {\n      if (interaction.replied) {\n        await interaction.editReply({\n          content: i18n.getString('Object `%s` is not of type state!', cfg.id),\n        });\n      } else {\n        await interaction.reply({\n          content: i18n.getString('Object `%s` is not of type state!', cfg.id),\n          ephemeral: true,\n        });\n      }\n      return [null, null];\n    }\n\n    return [obj, cfg];\n  }\n\n  /**\n   * Handler for \"get state\" slash commands.\n   * @param interaction The interaction which triggered this.\n   */\n  private async handleCmdGetState (interaction: CommandInteraction<CacheType>): Promise<void> {\n    const objAlias = interaction.options.get('state', true).value as string;\n\n    const [obj, cfg] = await this.getObjectAndCfgFromAlias(objAlias, interaction);\n    if (!obj || !cfg) {\n      return;\n    }\n\n    const objCustom: ioBroker.CustomConfig | undefined = obj.common.custom?.[this.adapter.namespace];\n\n    // check if get allowed\n    if (!objCustom?.commandsAllowGet) {\n      await interaction.reply({\n        content: i18n.getString('Get not allowed for state `%s`!', cfg.id),\n        ephemeral: true,\n      });\n      return;\n    }\n\n    // get the state\n    const state = await this.adapter.getForeignStateAsync(cfg.id);\n    if (!state) {\n      await interaction.reply({\n        content: i18n.getString('State `%s` not found!', cfg.id),\n        ephemeral: true,\n      });\n      return;\n    }\n\n    // defer the reply to have more time\n    if (!interaction.deferred) {\n      await interaction.deferReply({ ephemeral: this.adapter.config.commandRepliesEphemeral });\n    }\n\n    // get the value depending on the state type\n    let val: string = '';\n\n    // an optional MessageOptions object for special cases (like sending files)\n    let msgOpts: MessageCreateOptions | undefined = undefined;\n\n    // add unit if defined in the object\n    const unit = obj.common.unit ? ` ${obj.common.unit}` : '';\n\n    // add info about missing ack flag if configured so\n    const ack = objCustom.commandsShowAckFalse && !state.ack ? ` (_${i18n.getString('not acknowledged')}_)` : '';\n\n    if (obj.common.role === 'date' && ((obj.common.type === 'string' && typeof state.val === 'string') || (obj.common.type === 'number' && typeof state.val === 'number'))) {\n      // date values\n      const d = new Date(state.val);\n      val = d.toLocaleString(i18n.language, { dateStyle: 'full', timeStyle: 'long' });\n\n    } else if (obj.common.type === 'string' && objCustom.commandsStringSendAsFile && typeof state.val === 'string') {\n      // path or url to file or base64 encoded file\n      const b64data = getBufferAndNameFromBase64String(state.val);\n      if (b64data) {\n        // base64 encoded content\n\n        msgOpts = {\n          content: `${cfg.name}${ack}:`,\n          files: [{\n            attachment: b64data.buffer,\n            name: b64data.name,\n          }],\n        };\n        val = 'file:base64';\n\n      } else {\n        // file path or url\n\n        // remove file:// prefix\n        if (state.val.startsWith('file://')) {\n          state.val = state.val.slice(7);\n        }\n\n        msgOpts = {\n          content: `${cfg.name}${ack}:`,\n          files: [{\n            attachment: state.val,\n            name: getBasenameFromFilePathOrUrl(state.val),\n          }],\n        };\n        val = `file:${state.val}`;\n      }\n\n    } else {\n      // non special value\n      switch (obj.common.type) {\n        case 'boolean':\n          if (state.val) {\n            val = objCustom.commandsBooleanValueTrue ?? i18n.getString('true');\n          } else {\n            val = objCustom.commandsBooleanValueFalse ?? i18n.getString('false');\n          }\n          break;\n\n        case 'number':\n          // number values\n          const decimals = objCustom.commandsNumberDecimals ?? 0;\n          if (typeof state.val === 'number') {\n            val = state.val.toFixed(decimals);\n          } else if (state.val === null) {\n            val = '_NULL_';\n          } else {\n            val = state.val.toString() || 'NaN';\n          }\n          if (i18n.isFloatComma) {\n            val = val.replace('.', ',');\n          }\n          break;\n\n        default:\n          if (typeof state.val === 'string') {\n            val = state.val;\n          } else if (state.val === null) {\n            val = '_NULL_';\n          } else {\n            val = state.val.toString();\n          }\n      }\n    }\n\n    this.adapter.log.debug(`Get command for ${cfg.id} - ${val}${unit}${ack}`);\n\n    // send the value as reply to the user\n    try {\n      if (msgOpts) {\n        // message\n        await interaction.editReply(msgOpts);\n      } else {\n        // just text\n        await interaction.editReply(`${cfg.name}: ${val}${unit}${ack}`);\n      }\n    } catch (err) {\n      this.adapter.log.warn(`Error sending interaction reply for /${this.cmdGetStateName} command! ${err}`);\n    }\n  }\n\n  /**\n   * Handler for \"set state\" slash commands.\n   * @param interaction The interaction which triggered this.\n   */\n  private async handleCmdSetState (interaction: CommandInteraction<CacheType>): Promise<void> {\n    const objAlias = interaction.options.get('state', true).value as string;\n\n    const [obj, cfg] = await this.getObjectAndCfgFromAlias(objAlias, interaction);\n    if (!obj || !cfg) {\n      return;\n    }\n\n    const objCustom: ioBroker.CustomConfig | undefined = obj.common.custom?.[this.adapter.namespace];\n\n    // check if set allowed\n    if (!objCustom?.commandsAllowSet) {\n      await interaction.reply({\n        content: i18n.getString('Set not allowed for state `%s`!', cfg.id),\n        ephemeral: true,\n      });\n      return;\n    }\n\n    let valueStr = interaction.options.get('value')?.value;\n    if (typeof valueStr !== 'string') {\n      await interaction.reply({\n        content: i18n.getString('No value provided!'),\n        ephemeral: true,\n      });\n      return;\n    }\n\n    // defer the reply to have more time\n    if (!interaction.deferred) {\n      await interaction.deferReply({ ephemeral: this.adapter.config.commandRepliesEphemeral });\n    }\n\n    valueStr = valueStr.trim();\n\n    // add unit if defined in the object\n    const unit = obj.common.unit ? ` ${obj.common.unit}` : '';\n\n    let value: string | number | boolean;\n    let valueReply: string;\n\n    switch (obj.common.type) {\n      case 'boolean':\n        // parse as boolean value\n        valueStr = valueStr.toLowerCase();\n        if (valueStr === objCustom.commandsBooleanValueTrue?.toLowerCase() || this.wellKnownbooleanTrueValues.has(valueStr)) {\n          // true value form configures custom value or from well known boolean true values\n          value = true;\n          valueReply = objCustom.commandsBooleanValueTrue ?? i18n.getString('true');\n        } else {\n          // false value\n          value = false;\n          valueReply = objCustom.commandsBooleanValueFalse ?? i18n.getString('false');\n        }\n        break;\n\n      case 'number':\n        // parse as number (float) value\n        if (i18n.isFloatComma) {\n          valueStr = valueStr.replace(',', '.');\n        }\n        value = parseFloat(valueStr);\n\n        if (isNaN(value)) {\n          await interaction.editReply(i18n.getString('The given value is not a number!'));\n          return;\n        }\n\n        valueReply = value.toString();\n        if (i18n.isFloatComma) {\n          valueReply = valueReply.replace('.', ',');\n        }\n\n        // check min and max if configured\n        if (typeof obj.common.min === 'number' && value < obj.common.min) {\n          let min = obj.common.min.toString();\n          if (i18n.isFloatComma) {\n            min = min.replace('.', ',');\n          }\n          await interaction.editReply(i18n.getString('Value %s is below the allowed minium of %s!', `${valueReply}${unit}`, `${min}${unit}`));\n          return;\n        }\n        if (typeof obj.common.max === 'number' && value > obj.common.max) {\n          let max = obj.common.max.toString();\n          if (i18n.isFloatComma) {\n            max = max.replace('.', ',');\n          }\n          await interaction.editReply(i18n.getString('Value %s is above the allowed maximum of %s!', `${valueReply}${unit}`, `${max}${unit}`));\n          return;\n        }\n\n        break;\n\n      default:\n        // string values\n        value = valueStr;\n        valueReply = valueStr;\n    }\n\n    this.adapter.log.debug(`Set command for ${cfg.id} - ${value}${unit}`);\n\n    // set the state\n    try {\n      await this.adapter.setForeignStateAsync(cfg.id, value, !!objCustom.commandsSetWithAck);\n    } catch (err) {\n      this.adapter.log.warn(`Error while setting state ${cfg.id} to ${value}! ${err}`);\n      await interaction.editReply(i18n.getString('Error while setting the state value!'));\n      return;\n    }\n\n    // send reply\n    await interaction.editReply(`${cfg.name}: ${valueReply}${unit}`);\n  }\n\n  /**\n   * Handler for custom slash commands.\n   * @param interaction The interaction which triggered this.\n   */\n  private async handleCmdCustom (interaction: CommandInteraction<CacheType>): Promise<void> {\n    const {\n      commandName,\n      channelId,\n      guildId,\n      user,\n      options,\n    } = interaction;\n\n    // get the related custom command config\n    const cmdCfg = this.adapter.config.customCommands.find((c) => c.name === commandName);\n    if (!cmdCfg) return; // should never happen, but to be sure\n\n    // defer the reply to have more time\n    if (!interaction.deferred) {\n      await interaction.deferReply({ ephemeral: this.adapter.config.commandRepliesEphemeral });\n    }\n\n    // add this interaction to the collection of last interactions\n    this.lastInteractions.set(interaction.id, interaction);\n\n    // promises for all set state actions\n    const proms: Promise<any>[] = [];\n\n    // prepare json data\n    const json: JsonSlashCommandObj = {\n      interactionId: interaction.id,\n      commandName,\n      channelId,\n      serverId: guildId ?? null,\n      user: {\n        id: user.id,\n        tag: user.tag,\n        name: user.username,\n        displayName: interaction.member instanceof GuildMember ? interaction.member.displayName : user.username,\n      },\n      timestamp: interaction.createdTimestamp,\n      options: {},\n    };\n\n    // loop over configured options and prepare data ... options.data* may not be set for optional options\n    for (const optCfg of cmdCfg.options) {\n      const opt = options.data.find((o) => o.name === optCfg.name);\n      if (opt) {\n        json.options[optCfg.name] = {\n          value: opt.value ?? null,\n          type: ApplicationCommandOptionType[opt.type],\n        };\n\n        if (opt.user instanceof User) {\n          json.options[optCfg.name].user = {\n            id: opt.user.id,\n            tag: opt.user.tag,\n            name: opt.user.username,\n            bot: opt.user.bot,\n          };\n        }\n        if (opt.member instanceof GuildMember) {\n          json.options[optCfg.name].member = {\n            id: opt.member.id,\n            tag: opt.member.user.tag,\n            name: opt.member.user.username,\n            displayName: opt.member.displayName,\n            roles: opt.member.roles.cache.map((r) => ({ id: r.id, name: r.name })),\n          };\n        }\n        if (opt.role instanceof Role) {\n          json.options[optCfg.name].role = {\n            id: opt.role.id,\n            name: opt.role.name,\n          };\n        }\n        if (opt.channel instanceof GuildChannel) {\n          json.options[optCfg.name].channel = {\n            id: opt.channel.id,\n            name: opt.channel.name,\n            type: ChannelType[opt.channel.type] as ChannelTypeNames,\n            lastMessageId: (opt.channel.type === ChannelType.GuildText || opt.channel.type == ChannelType.GuildVoice) ? opt.channel.lastMessageId : null,\n          };\n        }\n      } else {\n        json.options[optCfg.name] = {\n          value: null,\n          type: null,\n        };\n      }\n      proms.push(this.adapter.setStateAsync(`slashCommands.${commandName}.option-${optCfg.name}.value`, json.options[optCfg.name].value, true));\n    }\n\n    // set the states\n    await Promise.all([\n      this.adapter.setStateAsync(`slashCommands.${commandName}.interactionId`, interaction.id, true),\n      this.adapter.setStateAsync(`slashCommands.${commandName}.channelId`, channelId, true),\n      this.adapter.setStateAsync(`slashCommands.${commandName}.serverId`, guildId ?? null, true),\n      this.adapter.setStateAsync(`slashCommands.${commandName}.userId`, user.id, true),\n      this.adapter.setStateAsync(`slashCommands.${commandName}.userTag`, user.tag, true),\n      this.adapter.setStateAsync(`slashCommands.${commandName}.userName`, user.username, true),\n      this.adapter.setStateAsync(`slashCommands.${commandName}.timestamp`, interaction.createdTimestamp, true),\n      this.adapter.setStateAsync(`slashCommands.${commandName}.json`, JSON.stringify(json), true),\n      ...proms,\n    ]);\n\n    /*****\n     * Hint: Interaction reply is deferred, but no reply will be send here.\n     *       The reply must be triggered by the user using the .sendReply state or a `sendTo(...)` action.\n     *****/\n\n    // remove outdated interactions\n    const outdatedTs = Date.now() - 15 * 60000; // 15 min\n    const removedInteractions = this.lastInteractions.sweep((ia) => ia.createdTimestamp < outdatedTs);\n    if (removedInteractions > 0) {\n      this.adapter.log.debug(`Removed ${removedInteractions} outdated interactions from cache`);\n    }\n  }\n\n  /**\n   * Send a reply to a custom slash command.\n   * @param interactionId The ID of the interaction to reply to. The interactions needs to be cached in this instance.\n   * @param msg The message to reply with. May be a simple string, a MessageOptions object or a stringified JSON MessageOptions object.\n   * @returns Promise which resolves withe the ID of the reply message if the reply is sent.\n   * @throws Error if the reply could not be sent for some reason (i.e. some check failed).\n   */\n  public async sendCmdCustomReply (interactionId: Snowflake, msg: string | MessageCreateOptions): Promise<Snowflake> {\n    // get the interaction\n    const interaction = this.lastInteractions.get(interactionId);\n\n    if (!interaction) {\n      throw new Error(`No current interaction with ID ${interactionId} found for reply!`);\n    }\n\n    const { commandName } = interaction;\n\n    const cmdCfg = this.adapter.config.customCommands.find((c) => c.name === commandName);\n    if (!cmdCfg) {\n      throw new Error(`No configuration for custom slash command ${commandName} of interaction ${interactionId} found for reply!`);\n    }\n\n    if (!interaction.isRepliable()) {\n      throw new Error(`Interaction ${interactionId} of custom slash command ${commandName} is not repliable!`);\n    }\n\n    // if a string is given try to parse it and prepare it as MessageOptions object\n    if (typeof msg === 'string') {\n      try {\n        msg = this.adapter.parseStringifiedMessageOptions(msg);\n      } catch (err) {\n        throw new Error(`Reply to interaction ${interactionId} of custom slash command ${commandName} is invalid: ${err}`);\n      }\n    }\n\n    // send the reply\n    const replyMsg = await interaction.editReply(msg);\n    return replyMsg.id;\n  }\n\n  /**\n   * Write a summay of all currently for commands configured objects to the log.\n   */\n  public logConfiguredCommandObjects (): void {\n    this.adapter.log.info('Configured state objects for discord slash commands:');\n    for (const [, cmdObjCfg] of this.commandObjectConfig) {\n      this.adapter.log.info(` |- ${cmdObjCfg.id} - alias:${cmdObjCfg.alias}, name:${cmdObjCfg.name}, get:${cmdObjCfg.get}, set:${cmdObjCfg.set}`);\n    }\n    this.adapter.log.info('---');\n  }\n}\n"],
  "mappings": "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",
  "names": []
}
