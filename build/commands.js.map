{
  "version": 3,
  "sources": ["../src/commands.ts"],
  "sourcesContent": ["import { isDeepStrictEqual } from 'node:util';\n\nimport { boundMethod } from 'autobind-decorator';\n\nimport {\n  CacheType,\n  Collection,\n  CommandInteraction,\n  DiscordAPIError,\n  Guild,\n  GuildChannel,\n  GuildMember,\n  Interaction,\n  MessageOptions,\n  Role,\n  Snowflake,\n  User,\n} from 'discord.js';\nimport { SlashCommandBuilder } from '@discordjs/builders';\nimport { REST } from '@discordjs/rest';\nimport { Routes } from 'discord-api-types/v10';\n\nimport type { DiscordAdapter } from './main';\nimport { i18n } from './lib/i18n';\nimport {\n  getBasenameFromFilePathOrUrl,\n  getBufferAndNameFromBase64String,\n} from './lib/utils';\nimport { JsonSlashCommandObj } from './lib/definitions';\n\nexport interface CommandObjectConfig {\n  id: string;\n  alias: string;\n  name: string;\n  get: boolean;\n  set: boolean;\n}\n\n/**\n * Class for discord slash commands handling\n */\nexport class DiscordAdapterSlashCommands {\n\n  /**\n   * Reference to the adapter instance.\n   */\n  private adapter: DiscordAdapter;\n\n  /**\n   * Discord REST api interface.\n   */\n  private rest: REST = new REST({ version: '10' });\n\n  /**\n   * Command name for the get state command.\n   */\n  private cmdGetStateName: string = 'iob-get';\n\n  /**\n   * Command name for the set state command.\n   */\n  private cmdSetStateName: string = 'iob-set';\n\n  /**\n   * Set of the known (registered) custom commands.\n   */\n  private customCommands: Set<string> = new Set();\n\n  /**\n   * If commands are fully registered including their permissions.\n   */\n  private registerCommandsDone: boolean = false;\n\n  /**\n   * The last registered commands.\n   * Used to check if something changed an we need to register the commands again.\n   */\n  private lastCommandsJson: any[] | null = null;\n\n  /**\n   * Collection of configurations for objects with commands enabled.\n   */\n  private commandObjectConfig: Collection<string, CommandObjectConfig> = new Collection();\n\n  /**\n   * Collection of the last seen interactions of custom commands (not iob-get/-set).\n   * Need to cache this here since there seams be no way to get an interaction by ID from discord.js.\n   */\n  private lastInteractions: Collection<Snowflake, CommandInteraction<CacheType>> = new Collection();\n\n  /**\n   * Timeout to trigger the delayed registration of the slash commands.\n   */\n  private triggerDelayedRegisterSlashCommandsTimeout: ioBroker.Timeout | null = null;\n\n  /**\n   * Set of well known values that will be interperted as true.\n   * This is extended by some localized strings at runtime.\n   * Used to determine true values from iob-set slash commands.\n   */\n  private wellKnownbooleanTrueValues: Set<string> = new Set(['true', 'on', 'yes', '1']);\n\n  constructor (adapter: DiscordAdapter) {\n    this.adapter = adapter;\n  }\n\n  /**\n   * When the adapter is Ready.\n   * Called by `adapter.onReady()` after some basic checks and setup.\n   */\n  public async onReady (): Promise<void> {\n    // apply custom command names if configured\n    if (this.adapter.config.cmdGetStateName) {\n      if (this.adapter.config.cmdGetStateName.match(/^[a-z][0-9a-z-_]{0,50}$/)) {\n        this.cmdGetStateName = this.adapter.config.cmdGetStateName;\n      } else {\n        this.adapter.log.warn(`Invalid custom get state command name '${this.adapter.config.cmdGetStateName}' provied! Using default 'iob-get'.`);\n      }\n    }\n    if (this.adapter.config.cmdSetStateName) {\n      this.cmdSetStateName = this.adapter.config.cmdSetStateName;\n      if (this.adapter.config.cmdSetStateName.match(/^[a-z][0-9a-z-_]{0,50}$/)) {\n        this.cmdSetStateName = this.adapter.config.cmdSetStateName;\n      } else {\n        this.adapter.log.warn(`Invalid custom set state command name '${this.adapter.config.cmdSetStateName}' provied! Using default 'iob-set'.`);\n      }\n    }\n\n    // setup REST interface\n    this.rest.setToken(this.adapter.config.token);\n\n    // check if commands are enabled\n    if (!this.adapter.config.enableCommands) {\n      return;\n    }\n\n    // add translated versions of true/on/yes to the set of well known boolean true values\n    this.wellKnownbooleanTrueValues.add(i18n.getString('true'))\n      .add(i18n.getString('on'))\n      .add(i18n.getString('yes'));\n\n    // setup interaction handler for commands\n    if (!this.adapter.client) {\n      throw new Error('Tried to setup interaction handler for commands, but client is not initialized!');\n    }\n    this.adapter.client.on('interactionCreate', this.onInteractionCreate);\n  }\n\n  /**\n   * Register the commands on discord, if enabled.\n   */\n  public async registerSlashCommands (): Promise<void> {\n    this.registerCommandsDone = false;\n\n    if (!this.adapter.client?.user) {\n      throw new Error('Discord client not available');\n    }\n\n    if (this.adapter.unloaded) return;\n\n    // check if commands are enabled and if not remove set commands\n    if (!this.adapter.config.enableCommands) {\n      this.adapter.log.debug('Commands not enabled');\n\n      // check for commands and remove them all\n      for (const [, guild] of this.adapter.client.guilds.cache) {\n        await this.removeGuildCommands(guild);\n      }\n\n      await this.removeGlobalCommands();\n\n      return;\n    }\n\n    // build commands array\n    const commands: SlashCommandBuilder[] = [];\n\n    const numGet = this.commandObjectConfig.filter((c) => c.get === true).size;\n    const numSet = this.commandObjectConfig.filter((c) => c.set === true).size;\n\n    // setup iob-get command if objects configured for get\n    if (numGet > 0) {\n      const cmdGet = new SlashCommandBuilder()\n        .setName(this.cmdGetStateName)\n        .setDescription(i18n.getString('Get an ioBroker state value'))\n        .setDefaultPermission(true);\n\n      // add options\n      cmdGet.addStringOption((opt) => {\n        opt.setName('state')\n          .setDescription(i18n.getString('The ioBroker state to get'))\n          .setRequired(true);\n        for (const [, objCfg] of this.commandObjectConfig) {\n          if (objCfg.get) {\n            opt.addChoices({\n              name: objCfg.name,\n              value: objCfg.alias,\n            });\n          }\n        }\n        return opt;\n      });\n\n      commands.push(cmdGet);\n    }\n\n    // setup iob-set command if objects configured for set\n    if (numSet > 0) {\n      const cmdSet = new SlashCommandBuilder()\n        .setName(this.cmdSetStateName)\n        .setDescription(i18n.getString('Set an ioBroker state value'))\n        .setDefaultPermission(true);\n\n      cmdSet.addStringOption((opt) => {\n        opt.setName('state')\n          .setDescription(i18n.getString('The ioBroker state to set'))\n          .setRequired(true);\n        for (const [, objCfg] of this.commandObjectConfig) {\n          if (objCfg.set) {\n            opt.addChoices({\n              name: objCfg.name,\n              value: objCfg.alias,\n            });\n          }\n        }\n        return opt;\n      });\n      cmdSet.addStringOption((opt) => {\n        return opt.setName('value')\n          .setDescription(i18n.getString('The value to set'))\n          .setRequired(true);\n      });\n\n      commands.push(cmdSet);\n    }\n\n    // custom commands\n    this.customCommands.clear();\n    if (this.adapter.config.enableCustomCommands) {\n      loopCustomCommands:\n      for (const customCommandCfg of this.adapter.config.customCommands) {\n        if (!customCommandCfg.name.match(/^[a-zA-Z][0-9a-z-_]{0,50}$/) || customCommandCfg.description.length === 0) {\n          this.adapter.log.warn(`Custom command \"${customCommandCfg.name}\" has an invalid name or description configured!`);\n          continue;\n        }\n\n        if (customCommandCfg.name === this.cmdGetStateName) {\n          this.adapter.log.warn(`Custom command \"${customCommandCfg.name}\" is configured but conflicts with default get command! The command will be ignored.`);\n          continue;\n        }\n        if (customCommandCfg.name === this.cmdSetStateName) {\n          this.adapter.log.warn(`Custom command \"${customCommandCfg.name}\" is configured but conflicts with default set command! The command will be ignored.`);\n          continue;\n        }\n\n        if (this.customCommands.has(customCommandCfg.name)) {\n          this.adapter.log.warn(`Custom command \"${customCommandCfg.name}\" is configured multiple times! The command will be ignored.`);\n          continue;\n        }\n\n        // create the command\n        const cmdCustom = new SlashCommandBuilder()\n          .setName(customCommandCfg.name)\n          .setDescription(customCommandCfg.description)\n          .setDefaultPermission(true);\n\n        // add configured options\n        const cmdOpts: Set<string> = new Set();\n        if (Array.isArray(customCommandCfg.options)) {\n          for (const customCommandCfgOpt of customCommandCfg.options) {\n            if (!customCommandCfgOpt.name.match(/^[a-z][0-9a-z-_]{0,50}$/) || customCommandCfgOpt.description.length === 0) {\n              this.adapter.log.warn(`Custom command \"${customCommandCfg.name}\" option \"${customCommandCfgOpt.name}\" has an invalid name or description configured!`);\n              continue loopCustomCommands;\n            }\n\n            if (cmdOpts.has(customCommandCfgOpt.name)) {\n              this.adapter.log.warn(`Custom command \"${customCommandCfg.name}\" option \"${customCommandCfgOpt.name}\" is configured multiple times! The command will be ignored.`);\n              continue loopCustomCommands;\n            }\n            cmdOpts.add(customCommandCfgOpt.name);\n\n            switch (customCommandCfgOpt.type) {\n              case 'string':\n                cmdCustom.addStringOption((opt) => opt.setName(customCommandCfgOpt.name).setDescription(customCommandCfgOpt.description).setRequired(!!customCommandCfgOpt.required));\n                break;\n\n              case 'number':\n                cmdCustom.addNumberOption((opt) => opt.setName(customCommandCfgOpt.name).setDescription(customCommandCfgOpt.description).setRequired(!!customCommandCfgOpt.required));\n                break;\n\n              case 'boolean':\n                cmdCustom.addBooleanOption((opt) => opt.setName(customCommandCfgOpt.name).setDescription(customCommandCfgOpt.description).setRequired(!!customCommandCfgOpt.required));\n                break;\n\n              case 'user':\n                cmdCustom.addUserOption((opt) => opt.setName(customCommandCfgOpt.name).setDescription(customCommandCfgOpt.description).setRequired(!!customCommandCfgOpt.required));\n                break;\n\n              case 'role':\n                cmdCustom.addRoleOption((opt) => opt.setName(customCommandCfgOpt.name).setDescription(customCommandCfgOpt.description).setRequired(!!customCommandCfgOpt.required));\n                break;\n\n              case 'channel':\n                cmdCustom.addChannelOption((opt) => opt.setName(customCommandCfgOpt.name).setDescription(customCommandCfgOpt.description).setRequired(!!customCommandCfgOpt.required));\n                break;\n\n              case 'mentionable':\n                cmdCustom.addMentionableOption((opt) => opt.setName(customCommandCfgOpt.name).setDescription(customCommandCfgOpt.description).setRequired(!!customCommandCfgOpt.required));\n                break;\n\n              default:\n                this.adapter.log.warn(`Custom command \"${customCommandCfg.name}\" option \"${customCommandCfgOpt.name} has an invalid type set\"!`);\n                continue loopCustomCommands;\n            }\n          }\n        }\n\n        // add custom command to the commands\n        commands.push(cmdCustom);\n        this.customCommands.add(customCommandCfg.name);\n      }\n    }\n\n    // check if any command is set and log an warning if not\n    if (commands.length === 0) {\n      if (this.adapter.config.enableCustomCommands) {\n        this.adapter.log.warn('Commands are enabled but not configured for any state object and no custom commands are configured! Use the custom configuration of a state object to activate commands on it or add custom commands in the adapter instance configuration.');\n      } else {\n        this.adapter.log.warn('Commands are enabled but not configured for any state object! Use the custom configuration of a state object to activate commands on it.');\n      }\n    }\n\n    const commandsJson = commands.map((cmd) => cmd.toJSON());\n\n    // only update the commands if something has changed\n    if (!isDeepStrictEqual(commandsJson, this.lastCommandsJson)) {\n      this.adapter.log.debug('Commands needs to be updated');\n\n      // create/update ioBroker states\n      await this.setupCustomCommandIobObjects();\n\n      // register commands for all servers of the bot (guild commands are applied instant and may have permissions per user set)\n      for (const [, guild] of this.adapter.client.guilds.cache) {\n        try {\n          if (this.adapter.config.commandsGlobal) {\n            // global commands enabled, remove per guild commands\n            await this.removeGuildCommands(guild);\n\n          } else {\n            // commands per guild\n            await this.rest.put(Routes.applicationGuildCommands(this.adapter.client.user.id, guild.id), { body: commandsJson });\n            this.adapter.log.info(`Registered commands for server ${guild.name} (id:${guild.id}) (get: ${numGet}, set: ${numSet}, custom: ${this.customCommands.size})`);\n          }\n\n        } catch (err) {\n          if (err instanceof DiscordAPIError && err.message === 'Missing Access'){\n            this.adapter.log.warn(`Error registering commands for server ${guild.name} (id:${guild.id}). Seams like the bot is missing the 'applications.commands' scope on the server. ${err}`);\n          } else {\n            this.adapter.log.warn(`Error registering commands for server ${guild.name} (id:${guild.id}): ${err}`);\n          }\n        }\n      }\n\n      // register global commands if enabled\n      try {\n        if (this.adapter.config.commandsGlobal) {\n          // global commands enabled\n          await this.rest.put(Routes.applicationCommands(this.adapter.client.user.id), { body: commandsJson });\n          this.adapter.log.info(`Registered global commands (get: ${numGet}, set: ${numSet}, custom: ${this.customCommands.size})`);\n\n        } else {\n          // global command disabled\n          await this.removeGlobalCommands();\n        }\n\n      } catch (err) {\n        if (err instanceof DiscordAPIError && err.message === 'Missing Access') {\n          this.adapter.log.warn(`Error registering global commands. Seams like the bot is missing the 'applications.commands' scope on the server. ${err}`);\n        } else {\n          this.adapter.log.warn(`Error registering global commands: ${err}`);\n        }\n      }\n\n      // cache the commandsJson for the next call of `registerSlashCommands()`\n      this.lastCommandsJson = commandsJson;\n\n    } else {\n      this.adapter.log.debug('Commands seams to be up to date');\n    }\n\n    this.registerCommandsDone = true;\n  }\n\n\n  /**\n   * Remove registered global commands if any.\n   */\n  private async removeGlobalCommands (): Promise<void> {\n    if (!this.adapter.client?.user) {\n      throw new Error('Discord client not available');\n    }\n\n    try {\n      const globalCommands = await this.adapter.client.application?.commands.fetch();\n      if (this.adapter.unloaded) return;\n\n      if (globalCommands && globalCommands.size > 0) {\n        this.adapter.log.debug(`Currently ${globalCommands.size} global commands registered. Removing them...`);\n        await this.rest.put(Routes.applicationCommands(this.adapter.client.user.id), { body: [] });\n        this.adapter.log.info(`Removed global commands cause commands they are not used anymore.`);\n      }\n    } catch (err) {\n      if (err instanceof DiscordAPIError && err.message === 'Missing Access') {\n        this.adapter.log.warn(`Error while removing registered global commands. Seams like the bot is missing the 'applications.commands' scope on the server. ${err}`);\n      } else {\n        this.adapter.log.warn(`Error while removing registered global commands: ${err}`);\n      }\n    }\n  }\n\n  /**\n   * Remove registered guild commands if any.\n   * @param guild The guild.\n   */\n  private async removeGuildCommands (guild: Guild): Promise<void> {\n    if (!this.adapter.client?.user) {\n      throw new Error('Discord client not available');\n    }\n\n    try {\n      const guildCommands = await guild.commands.fetch();\n      if (this.adapter.unloaded) return;\n\n      if (guildCommands.size > 0) {\n        this.adapter.log.debug(`Currently ${guildCommands.size} commands registered for server ${guild.name}. Removing them...`);\n        await this.rest.put(Routes.applicationGuildCommands(this.adapter.client.user.id, guild.id), { body: [] });\n        this.adapter.log.info(`Removed commands for server ${guild.name} cause commands they are not used anymore.`);\n      }\n    } catch (err) {\n      if (err instanceof DiscordAPIError && err.message === 'Missing Access') {\n        this.adapter.log.warn(`Error while removing registered commands for server ${guild.name} (id:${guild.id}). Seams like the bot is missing the 'applications.commands' scope on the server. ${err}`);\n      } else {\n        this.adapter.log.warn(`Error while removing registered commands for server ${guild.name} (id:${guild.id}): ${err}`);\n      }\n    }\n  }\n\n  private async setupCustomCommandIobObjects (): Promise<void> {\n    for (const cmdName of this.customCommands) {\n      const cmdCfg = this.adapter.config.customCommands.find((c) => c.name === cmdName);\n      if (!cmdCfg) continue; // should never happen, but to be sure\n\n      await this.adapter.extendObjectAsyncCached(`slashCommands.${cmdName}`, {\n        type: 'channel',\n        common: {\n          name: cmdCfg.description,\n        },\n        native: {},\n      });\n\n      // generic custom command objects\n      await Promise.all([\n        this.adapter.extendObjectAsyncCached(`slashCommands.${cmdName}.json`, {\n          type: 'state',\n          common: {\n            name: i18n.getStringOrTranslated('JSON data'),\n            role: 'json',\n            type: 'string',\n            read: true,\n            write: false,\n            def: '',\n          },\n          native: {},\n        }),\n        this.adapter.extendObjectAsyncCached(`slashCommands.${cmdName}.timestamp`, {\n          type: 'state',\n          common: {\n            name: i18n.getStringOrTranslated('Last use timestamp'),\n            role: 'date',\n            type: 'number',\n            read: true,\n            write: false,\n            def: 0,\n          },\n          native: {},\n        }),\n        this.adapter.extendObjectAsyncCached(`slashCommands.${cmdName}.sendReply`, {\n          type: 'state',\n          common: {\n            name: i18n.getStringOrTranslated('Send reply'),\n            role: 'text',\n            type: 'string',\n            read: false,\n            write: true,\n            def: '',\n          },\n          native: {},\n        }),\n        this.adapter.extendObjectAsyncCached(`slashCommands.${cmdName}.interactionId`, {\n          type: 'state',\n          common: {\n            name: i18n.getStringOrTranslated('Interaction ID'),\n            role: 'text',\n            type: 'string',\n            read: true,\n            write: false,\n            def: '',\n          },\n          native: {},\n        }),\n        this.adapter.extendObjectAsyncCached(`slashCommands.${cmdName}.userId`, {\n          type: 'state',\n          common: {\n            name: i18n.getStringOrTranslated('User ID'),\n            role: 'text',\n            type: 'string',\n            read: true,\n            write: false,\n            def: '',\n          },\n          native: {},\n        }),\n        this.adapter.extendObjectAsyncCached(`slashCommands.${cmdName}.userTag`, {\n          type: 'state',\n          common: {\n            name: i18n.getStringOrTranslated('User tag'),\n            role: 'text',\n            type: 'string',\n            read: true,\n            write: false,\n            def: '',\n          },\n          native: {},\n        }),\n        this.adapter.extendObjectAsyncCached(`slashCommands.${cmdName}.serverId`, {\n          type: 'state',\n          common: {\n            name: i18n.getStringOrTranslated('Server ID'),\n            role: 'text',\n            type: 'string',\n            read: true,\n            write: false,\n            def: '',\n          },\n          native: {},\n        }),\n        this.adapter.extendObjectAsyncCached(`slashCommands.${cmdName}.channelId`, {\n          type: 'state',\n          common: {\n            name: i18n.getStringOrTranslated('Channel ID'),\n            role: 'text',\n            type: 'string',\n            read: true,\n            write: false,\n            def: '',\n          },\n          native: {},\n        }),\n      ]);\n\n      // custom command option objects\n      const proms: Promise<any>[] = [];\n      for (const cmdCfgOpt of cmdCfg.options) {\n        let role: string;\n        let type: ioBroker.CommonType;\n        let def: any;\n        switch (cmdCfgOpt.type) {\n          case 'number':\n            role = 'value';\n            type = 'number';\n            def = null;\n            break;\n\n          case 'boolean':\n            role = 'indicator';\n            type = 'boolean';\n            def = null;\n            break;\n\n          default:\n            role = 'text';\n            type = 'string';\n            def = '';\n        }\n\n        proms.push(this.adapter.extendObjectAsyncCached(`slashCommands.${cmdName}.option-${cmdCfgOpt.name}`, {\n          type: 'state',\n          common: {\n            name: i18n.getStringOrTranslated('Option %s', cmdCfgOpt.description),\n            role,\n            type,\n            read: true,\n            write: false,\n            def,\n          },\n          native: {},\n        }));\n      }\n\n      // check for unused (old) custom command option objects and remove them\n      const objListOptions = await this.adapter.getObjectListAsync({\n        startkey: `${this.adapter.namespace}.slashCommands.${cmdName}.option-`,\n        endkey: `${this.adapter.namespace}.slashCommands.${cmdName}.option-\\u9999`,\n      });\n      const reOptionsName = new RegExp(`^${this.adapter.name}\\\\.${this.adapter.instance}\\\\.slashCommands\\\\.${cmdName}\\\\.option-(.*)$`);\n      for (const item of objListOptions.rows) {\n        const m = item.id.match(reOptionsName);\n        if (m) {\n          const oldoptName = m[1];\n          if (!cmdCfg.options.find((o) => o.name === oldoptName)) {\n            // option does not exist... delete the object\n            proms.push(this.adapter.delObjectAsyncCached(`slashCommands.${cmdName}.option-${oldoptName}`));\n          }\n        }\n      }\n\n      // wait for object create/delete\n      await Promise.all(proms);\n    }\n  }\n\n  /**\n   * Setup an ioBroker object for discord slash commands.\n   * @param objId ID of the ioBroker object to set up.\n   * @param cfg Command configuration for the ioBroker object or null to remove a possibly existing configuration.\n   */\n  public setupCommandObject (objId: string, cfg: CommandObjectConfig | null): void {\n    // check if alias is already in use\n    if (cfg) {\n      const conflictingAlias = this.commandObjectConfig.find((coc) => coc.alias === cfg?.alias && coc.id !== cfg.id);\n      if (conflictingAlias) {\n        this.adapter.log.warn(`Command alias ${cfg.alias} of object ${cfg.id} already in use by object ${conflictingAlias.id}! ${cfg.id} will be ignored.`);\n        cfg = null;\n      }\n    }\n\n    // remove if commands are not enabled or alias conflict\n    if (!cfg) {\n      if (this.commandObjectConfig.has(objId)) {\n        this.commandObjectConfig.delete(objId);\n        this.triggerDelayedRegisterSlashCommands();\n      }\n      return;\n    }\n\n    // update only if changed\n    const currentCfg = this.commandObjectConfig.get(objId);\n    if (!isDeepStrictEqual(cfg, currentCfg)) {\n      this.adapter.log.debug(`Update command configuration for ${objId}: ${JSON.stringify(cfg)}`);\n      this.commandObjectConfig.set(objId, cfg);\n      this.triggerDelayedRegisterSlashCommands();\n    }\n  }\n\n  /**\n   * Initialize a delayed registration of the slash commands.\n   * Calls `registerSlashCommands()` five seconds after the last call of this method.\n   * If called again within the five seconds the timeout starts again.\n   *\n   * This is used to handle object changes better and concat multiple changed\n   * object configurations into a single API call.\n   *\n   * If the initial custom objects setup of the adapter isn't done, this method\n   * does nothing since the command registration is called during this explicit.\n   */\n  private triggerDelayedRegisterSlashCommands (): void {\n    // do nothing on init\n    if (!this.adapter.initialCustomObjectSetupDone) return;\n\n    if (this.triggerDelayedRegisterSlashCommandsTimeout) {\n      this.adapter.clearTimeout(this.triggerDelayedRegisterSlashCommandsTimeout);\n    }\n\n    this.adapter.setTimeout(() => {\n      this.triggerDelayedRegisterSlashCommandsTimeout = null;\n      this.adapter.log.debug('Starting delayed slash commands registration...');\n      this.registerSlashCommands();\n    }, 5000);\n  }\n\n  /**\n   * Handle interaction commands.\n   */\n  @boundMethod\n  private async onInteractionCreate (interaction: Interaction<CacheType>): Promise<void> {\n\n    // raw states enabled?\n    if (this.adapter.config.enableRawStates) {\n      // set raw state... not async here since it should not block!\n      const interactionJson = interaction.toJSON() as Record<string, unknown>;\n      if (interaction.isCommand()) {\n        interactionJson.options = interaction.options.data;\n      }\n      this.adapter.setState('raw.interactionJson', JSON.stringify(interactionJson, (_key, value) => typeof value === 'bigint' ? value.toString() : value), true);\n    }\n\n    // is it a command?\n    if (!interaction.isCommand()) return;\n\n    if (!interaction.deferred) {\n      await interaction.deferReply();\n    }\n\n    const { commandName, user } = interaction;\n\n    if (!this.registerCommandsDone) {\n      this.adapter.log.warn(`Got command ${commandName} but command registration is not done yet.`);\n      return;\n    }\n\n    this.adapter.log.debug(`Got command ${commandName} ${JSON.stringify(interaction.options.data)}`);\n\n    const authCheckTarget = interaction.member instanceof GuildMember ? interaction.member : user;\n\n    if (commandName === this.cmdGetStateName) {\n      // check user authorization\n      if (this.adapter.checkUserAuthorization(authCheckTarget, { getStates: true })) {\n        // user authorized\n        await this.handleCmdGetState(interaction);\n      } else {\n        // user not authorized\n        this.adapter.log.warn(`User ${user.tag} (id:${user.id}) is not authorized to call /${commandName} commands!`);\n        await interaction.editReply(i18n.getString('You are not authorized to call this command!'));\n      }\n\n    } else if (commandName === this.cmdSetStateName) {\n      // check user authorization\n      if (this.adapter.checkUserAuthorization(authCheckTarget, { setStates: true })) {\n        // user authorized\n        await this.handleCmdSetState(interaction);\n      } else {\n        // user not authorized\n        this.adapter.log.warn(`User ${user.tag} (id:${user.id}) is not authorized to call /${commandName} commands!`);\n        await interaction.editReply(i18n.getString('You are not authorized to call this command!'));\n      }\n\n    } else if (this.customCommands.has(commandName)) {\n      // check user authorization\n      if (this.adapter.checkUserAuthorization(authCheckTarget, { useCustomCommands: true })) {\n        // user authorized\n        await this.handleCmdCustom(interaction);\n      } else {\n        // user not authorized\n        this.adapter.log.warn(`User ${user.tag} (id:${user.id}) is not authorized to call /${commandName} commands!`);\n        await interaction.editReply(i18n.getString('You are not authorized to call this command!'));\n      }\n\n    } else {\n      this.adapter.log.warn(`Got unknown command ${commandName}!`);\n      await interaction.editReply(i18n.getString('Unknown command!'));\n    }\n  }\n\n  /**\n   * Try to get the ioBroker object and CommandObjectConfig for a given object alias.\n   * The object will be checked if it's a valid state object.\n   * @param objAlias The alias of the object.\n   * @param interaction The interaction for replies on errors.\n   * @returns Array containing the object and the config or null and null.\n   */\n  private async getObjectAndCfgFromAlias (objAlias: string | null, interaction: CommandInteraction<CacheType>): Promise<[ioBroker.StateObject | null, CommandObjectConfig | null]> {\n    // find the config for the requested object\n    const cfg = this.commandObjectConfig.find((coc) => coc.alias === objAlias);\n    if (!cfg) {\n      await interaction.editReply(i18n.getString('Object `%s` not found!', objAlias || ''));\n      return [null, null];\n    }\n\n    // get the object\n    const obj = await this.adapter.getForeignObjectAsync(cfg.id);\n    if (!obj) {\n      await interaction.editReply(i18n.getString('Object `%s` not found!', cfg.id));\n      return [null, null];\n    }\n    if (obj.type !== 'state') {\n      await interaction.editReply(i18n.getString('Object `%s` is not of type state!', cfg.id));\n      return [null, null];\n    }\n\n    return [obj, cfg];\n  }\n\n  /**\n   * Handler for \"get state\" slash commands.\n   * @param interaction The interaction which triggered this.\n   */\n  private async handleCmdGetState (interaction: CommandInteraction<CacheType>): Promise<void> {\n    const objAlias = interaction.options.getString('state');\n\n    const [obj, cfg] = await this.getObjectAndCfgFromAlias(objAlias, interaction);\n    if (!obj || !cfg) {\n      return;\n    }\n\n    const objCustom: ioBroker.CustomConfig | undefined = obj.common.custom?.[this.adapter.namespace];\n\n    // check if get allowed\n    if (!objCustom?.commandsAllowGet) {\n      await interaction.editReply(i18n.getString('Get not allowed for state `%s`!', cfg.id));\n      return;\n    }\n\n    // get the state\n    const state = await this.adapter.getForeignStateAsync(cfg.id);\n    if (!state) {\n      await interaction.editReply(i18n.getString('State `%s` not found!', cfg.id));\n      return;\n    }\n\n    // get the value depending on the state type\n    let val: string = '';\n\n    // an optional MessageOptions object for special cases (like sending files)\n    let msgOpts: MessageOptions | undefined = undefined;\n\n    // add unit if defined in the object\n    const unit = obj.common.unit ? ` ${obj.common.unit}` : '';\n\n    // add info about missing ack flag if configured so\n    const ack = objCustom.commandsShowAckFalse && !state.ack ? ` (_${i18n.getString('not acknowledged')}_)` : '';\n\n    if (obj.common.role === 'date' && ((obj.common.type === 'string' && typeof state.val === 'string') || (obj.common.type === 'number' && typeof state.val === 'number'))) {\n      // date values\n      const d = new Date(state.val);\n      val = d.toLocaleString(i18n.language, { dateStyle: 'full', timeStyle: 'long' });\n\n    } else if (obj.common.type === 'string' && objCustom.commandsStringSendAsFile && typeof state.val === 'string') {\n      // path or url to file or base64 encoded file\n      const b64data = getBufferAndNameFromBase64String(state.val);\n      if (b64data) {\n        // base64 encoded content\n\n        msgOpts = {\n          content: `${cfg.name}${ack}:`,\n          files: [{\n            attachment: b64data.buffer,\n            name: b64data.name,\n          }],\n        };\n        val = 'file:base64';\n\n      } else {\n        // file path or url\n\n        // remove file:// prefix\n        if (state.val.startsWith('file://')) {\n          state.val = state.val.slice(7);\n        }\n\n        msgOpts = {\n          content: `${cfg.name}${ack}:`,\n          files: [{\n            attachment: state.val,\n            name: getBasenameFromFilePathOrUrl(state.val),\n          }],\n        };\n        val = `file:${state.val}`;\n      }\n\n    } else {\n      // non special value\n      switch (obj.common.type) {\n        case 'boolean':\n          if (state.val) {\n            val = objCustom.commandsBooleanValueTrue || i18n.getString('true');\n          } else {\n            val = objCustom.commandsBooleanValueFalse || i18n.getString('false');\n          }\n          break;\n\n        case 'number':\n          // number values\n          const decimals = objCustom.commandsNumberDecimals || 0;\n          if (typeof state.val === 'number') {\n            val = state.val.toFixed(decimals);\n          } else if (state.val === null) {\n            val = '_NULL_';\n          } else {\n            val = state.val.toString() || 'NaN';\n          }\n          if (i18n.isFloatComma) {\n            val = val.replace('.', ',');\n          }\n          break;\n\n        default:\n          if (typeof state.val === 'string') {\n            val = state.val;\n          } else if (state.val === null) {\n            val = '_NULL_';\n          } else {\n            val = state.val.toString();\n          }\n      }\n    }\n\n    this.adapter.log.debug(`Get command for ${cfg.id} - ${val}${unit}${ack}`);\n\n    // send the value as reply to the user\n    try {\n      if (msgOpts) {\n        // message\n        await interaction.editReply(msgOpts);\n      } else {\n        // just text\n        await interaction.editReply(`${cfg.name}: ${val}${unit}${ack}`);\n      }\n    } catch (err) {\n      this.adapter.log.warn(`Error sending interaction reply for /${this.cmdGetStateName} command! ${err}`);\n    }\n  }\n\n  /**\n   * Handler for \"set state\" slash commands.\n   * @param interaction The interaction which triggered this.\n   */\n  private async handleCmdSetState (interaction: CommandInteraction<CacheType>): Promise<void> {\n    const objAlias = interaction.options.getString('state');\n\n    const [obj, cfg] = await this.getObjectAndCfgFromAlias(objAlias, interaction);\n    if (!obj || !cfg) {\n      return;\n    }\n\n    const objCustom: ioBroker.CustomConfig | undefined = obj.common.custom?.[this.adapter.namespace];\n\n    // check if set allowed\n    if (!objCustom?.commandsAllowSet) {\n      await interaction.editReply(i18n.getString('Set not allowed for state `%s`!', cfg.id));\n      return;\n    }\n\n    let valueStr = interaction.options.getString('value');\n    if (typeof valueStr !== 'string') {\n      await interaction.editReply(i18n.getString('No value provided!'));\n      return;\n    }\n\n    valueStr = valueStr.trim();\n\n    // add unit if defined in the object\n    const unit = obj.common.unit ? ` ${obj.common.unit}` : '';\n\n    let value: string | number | boolean;\n    let valueReply: string;\n\n    switch (obj.common.type) {\n      case 'boolean':\n        // parse as boolean value\n        valueStr = valueStr.toLowerCase();\n        if (valueStr === objCustom.commandsBooleanValueTrue?.toLowerCase() || this.wellKnownbooleanTrueValues.has(valueStr)) {\n          // true value form configures custom value or from well known boolean true values\n          value = true;\n          valueReply = objCustom.commandsBooleanValueTrue || i18n.getString('true');\n        } else {\n          // false value\n          value = false;\n          valueReply = objCustom.commandsBooleanValueFalse || i18n.getString('false');\n        }\n        break;\n\n      case 'number':\n        // parse as number (float) value\n        if (i18n.isFloatComma) {\n          valueStr = valueStr.replace(',', '.');\n        }\n        value = parseFloat(valueStr);\n\n        if (isNaN(value)) {\n          await interaction.editReply(i18n.getString('The given value is not a number!'));\n          return;\n        }\n\n        valueReply = value.toString();\n        if (i18n.isFloatComma) {\n          valueReply = valueReply.replace('.', ',');\n        }\n\n        // check min and max if configured\n        if (typeof obj.common.min === 'number' && value < obj.common.min) {\n          let min = obj.common.min.toString();\n          if (i18n.isFloatComma) {\n            min = min.replace('.', ',');\n          }\n          await interaction.editReply(i18n.getString('Value %s is below the allowed minium of %s!', `${valueReply}${unit}`, `${min}${unit}`));\n          return;\n        }\n        if (typeof obj.common.max === 'number' && value > obj.common.max) {\n          let max = obj.common.max.toString();\n          if (i18n.isFloatComma) {\n            max = max.replace('.', ',');\n          }\n          await interaction.editReply(i18n.getString('Value %s is above the allowed maximum of %s!', `${valueReply}${unit}`, `${max}${unit}`));\n          return;\n        }\n\n        break;\n\n      default:\n        // string values\n        value = valueStr;\n        valueReply = valueStr;\n    }\n\n    this.adapter.log.debug(`Set command for ${cfg.id} - ${value}${unit}`);\n\n    // set the state\n    try {\n      await this.adapter.setForeignStateAsync(cfg.id, value, !!objCustom.commandsSetWithAck);\n    } catch (err) {\n      this.adapter.log.warn(`Error while setting state ${cfg.id} to ${value}! ${err}`);\n      await interaction.editReply(i18n.getString('Error while setting the state value!'));\n      return;\n    }\n\n    // send reply\n    await interaction.editReply(`${cfg.name}: ${valueReply}${unit}`);\n  }\n\n  /**\n   * Handler for custom slash commands.\n   * @param interaction The interaction which triggered this.\n   */\n  private async handleCmdCustom (interaction: CommandInteraction<CacheType>): Promise<void> {\n    const {\n      commandName,\n      channelId,\n      guildId,\n      user,\n      options,\n    } = interaction;\n\n    // get the related custom command config\n    const cmdCfg = this.adapter.config.customCommands.find((c) => c.name === commandName);\n    if (!cmdCfg) return; // should never happen, but to be sure\n\n    // add this interaction to the collection of last interactions\n    this.lastInteractions.set(interaction.id, interaction);\n\n    // promises for all set state actions\n    const proms: Promise<any>[] = [];\n\n    // prepare json data\n    const json: JsonSlashCommandObj = {\n      interactionId: interaction.id,\n      commandName,\n      channelId,\n      serverId: guildId || null,\n      user: {\n        id: user.id,\n        tag: user.tag,\n        displayName: interaction.member instanceof GuildMember ? interaction.member.displayName : user.username,\n      },\n      timestamp: interaction.createdTimestamp,\n      options: {},\n    };\n\n    // loop over configured options and prepare data ... options.data* may not be set for optional options\n    for (const optCfg of cmdCfg.options) {\n      const opt = options.data.find((o) => o.name === optCfg.name);\n      if (opt) {\n        json.options[optCfg.name] = {\n          val: opt.value !== undefined ? opt.value : null,\n          type: opt.type,\n        };\n\n        if (opt.user instanceof User) {\n          json.options[optCfg.name].user = {\n            id: opt.user.id,\n            tag: opt.user.tag,\n            bot: opt.user.bot,\n          };\n        }\n        if (opt.member instanceof GuildMember) {\n          json.options[optCfg.name].member = {\n            id: opt.member.id,\n            displayName: opt.member.displayName,\n            roles: opt.member.roles.cache.map((r) => ({ id: r.id, name: r.name })),\n          };\n        }\n        if (opt.role instanceof Role) {\n          json.options[optCfg.name].role = {\n            id: opt.role.id,\n            name: opt.role.name,\n          };\n        }\n        if (opt.channel instanceof GuildChannel) {\n          json.options[optCfg.name].channel = {\n            id: opt.channel.id,\n            name: opt.channel.name,\n            type: opt.channel.type,\n            lastMessageId: opt.channel.isText() ? opt.channel.lastMessageId : null,\n          };\n        }\n      } else {\n        json.options[optCfg.name] = {\n          val: null,\n          type: null,\n        };\n      }\n      proms.push(this.adapter.setStateAsync(`slashCommands.${commandName}.option-${optCfg.name}`, json.options[optCfg.name].val, true));\n    }\n\n    // set the states\n    await Promise.all([\n      this.adapter.setStateAsync(`slashCommands.${commandName}.interactionId`, interaction.id, true),\n      this.adapter.setStateAsync(`slashCommands.${commandName}.channelId`, channelId, true),\n      this.adapter.setStateAsync(`slashCommands.${commandName}.serverId`, guildId || null, true),\n      this.adapter.setStateAsync(`slashCommands.${commandName}.userId`, user.id, true),\n      this.adapter.setStateAsync(`slashCommands.${commandName}.userTag`, user.tag, true),\n      this.adapter.setStateAsync(`slashCommands.${commandName}.timestamp`, interaction.createdTimestamp, true),\n      this.adapter.setStateAsync(`slashCommands.${commandName}.json`, JSON.stringify(json), true),\n      ...proms,\n    ]);\n\n    /*****\n     * Hint: Interaction reply is deferred, but no reply will be send here.\n     *       The reply must be triggered by the user using the .sendReply state or a `sendTo(...)` action.\n     *****/\n\n    // remove outdated interactions\n    const outdatedTs = Date.now() - 15 * 60000; // 15 min\n    const removedInteractions = this.lastInteractions.sweep((ia) => ia.createdTimestamp < outdatedTs);\n    if (removedInteractions > 0) {\n      this.adapter.log.debug(`Removed ${removedInteractions} outdated interactions from cache`);\n    }\n  }\n\n  /**\n   * Send a reply to a custom slash command.\n   * @param interactionId The ID of the interaction to reply to. The interactions needs to be cached in this instance.\n   * @param msg The message to reply with. May be a simple string, a MessageOptions object or a stringified JSON MessageOptions object.\n   * @returns Promise which resolves withe the ID of the reply message if the reply is sent.\n   * @throws Error if the reply could not be sent for some reason (i.e. some check failed).\n   */\n  public async sendCmdCustomReply (interactionId: Snowflake, msg: string | MessageOptions): Promise<Snowflake> {\n    // get the interaction\n    const interaction = this.lastInteractions.get(interactionId);\n\n    if (!interaction) {\n      throw new Error(`No current interaction with ID ${interactionId} found for reply!`);\n    }\n\n    const { commandName } = interaction;\n\n    const cmdCfg = this.adapter.config.customCommands.find((c) => c.name === commandName);\n    if (!cmdCfg) {\n      throw new Error(`No configuration for custom slash command ${commandName} of interaction ${interactionId} found for reply!`);\n    }\n\n    if (!interaction.isRepliable()) {\n      throw new Error(`Interaction ${interactionId} of custom slash command ${commandName} is not repliable!`);\n    }\n\n    // if a string is given try to parse it and prepare it as MessageOptions object\n    if (typeof msg === 'string') {\n      try {\n        msg = this.adapter.parseStringifiedMessageOptions(msg);\n      } catch (err) {\n        throw new Error(`Reply to interaction ${interactionId} of custom slash command ${commandName} is invalid: ${err}`);\n      }\n    }\n\n    // send the reply\n    const replyMsg = await interaction.editReply(msg);\n    return replyMsg.id;\n  }\n\n  /**\n   * Write a summay of all currently for commands configured objects to the log.\n   */\n  public logConfiguredCommandObjects (): void {\n    this.adapter.log.info('Configured state objects for discord slash commands:');\n    for (const [, cmdObjCfg] of this.commandObjectConfig) {\n      this.adapter.log.info(` |- ${cmdObjCfg.id} - alias:${cmdObjCfg.alias}, name:${cmdObjCfg.name}, get:${cmdObjCfg.get}, set:${cmdObjCfg.set}`);\n    }\n    this.adapter.log.info('---');\n  }\n}\n"],
  "mappings": "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",
  "names": []
}
